# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара

```
export interface IProduct {
	id: string;
	image: string;
	category: string;
	title: string;
	description: string;
	price: number | null;
}
```

Данные для формы заказа

```
export interface IFormOrder {
	items: string[];
	payment: string;
	address: string;
	email: string;
	phone: string;
	total: number;
}
```

Интерфейс для модели данных карточек

```
export interface IProductData {
	catalog: IProduct[];
	preview: string | null;
}
```

Интерфейс для формы успешного заказа

```
export interface IFormOrderResult {
	id: string;
	total: number;
}
```

Данные карточки, используемые в модальном окне с корзиной

```
export type TBasketProduct = Pick<IProduct, 'id' | 'title' | 'price'>;
```

Основные данные, которые заполняет пользователь при заказе

```
export type TOrderInfo = Pick<IFormOrder, 'payment' | 'address' | 'email' | 'phone'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Абстрактный класс Model

Базовая модель, которая позволяет установить исходные данные в класс и отличить ее от простых объектов с данными.\
Конструктор принимает объект, в котором все свойства заданного типа являются необязательными, и инстант брокера событий.
- constructor(data: Partial<T>, protected events: IEvents)

Методы:
- emitChanges(event: string, payload?: object) - сообщает всем, что модель изменилась

#### Абстрактный класс Component

Базовый компонент, который позволяет работать с DOM-элементами.\
Конструктор принимает контейнер с разметкой.
- constructor(protected readonly container: HTMLElement)

Методы:
- toggleClass(element: HTMLElement, className: string, force?: boolean) - переключить класс
- setDisabled(element: HTMLElement, state: boolean) - сменить статус блокировки
- render(data?: Partial<T>): HTMLElement - вернуть корневой DOM-элемент

### Слой данных

#### Класс Product
Класс наследуется от Model с типом IProduct, отвечает за хранения данных товара.\
В полях класса хранятся следующие данные:
- id: string; - id товара
- image: string; - картинка товара
- category: string; - категория товара
- title: string; - имя товара
- description: string; - описание товара
- price: number | null; - цена товара

#### Класс AppData
Класс отвечает за хранение и логику работы с данными.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- catalog: IProduct[] - массив объектов карточек продукта
- preview: string | null - id карточки, выбранной для просмотра в модальной окне
- order: IFormOrder - объект с данными для оформления заказа
- basket: Map<string, number>; - товары в корзине
- formOrderErrors - ошибки в форме заказа
- formContacts - ошибки в форме контактов

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- setCatalog - карточки для каталога
- getProduct(productId: string): IProduct - возвращает карточку по ее id
- isInBasket - проверка товара в корзине
- addProduct(productId: string): void - добавляет продукт в корзину
- deleteProduct(cardId: string): void - удаляет продукт из корзины
- toggleOrderedProduct - переключение состояниия товара в корзине
- getCounter - количество товара в корзиине
- getBasketProducts - состав корзиины
- clearBasket - очистка корзины
- getTotal - итоговая цена в коризне
- setOrderItems - перенос товаров из корзины в заказ
- setOrderTotal - перенос итоговой суммы заказа
- validateOrder - валидация формы заказа
- validateContacts - валидация формы контакты
- setOrderField - установка значений полей в заказе

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Класс наследуется от Component с типом IPage и реализует страницу сайта. Конструктор принимает контейнер модального окна и экземпляр класса EventEmitter для инициации событий.
- constructor(container: HTMLElement, protected events: IEvents)

Поля класса:
- counter: HTMLElement - счетчик товаров в корзине
- catalog: HTMLElement - каталог
- wrapper: HTMLElement - обертка страницы
- basket: HTMLElement - корзина

Методы:
- сеттеры для полей класса

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.
Конструктор принимает контейнер модальноого окна.
- constructor(selector: string, events: IEvents) 

Поля класса
- _content: HTMLElement - элемент модального окна
- _closeButton: кнопка закрытия модального окна

#### Класс Form
Класс наследуется от Component с типом IFormState и реализует элемент формы. Предоставляет метод onInputChange, имитирующий события при изменении полей формы, метод render для установки значений и получения контейнера, а также сеттеры полей класса. Конструктор принимает контейнер с разметкой формы и экземпляр класса EventEmitter для возможности инициации событий.
- constructor(protected container: HTMLFormElement, protected events: IEvents)

Поля класса:
- submit: HTMLButtonElement - кнопка отправки формы
- errors: HTMLElement - ошибки валидации полей формы

#### Класс Basket
Класс наследуется от Component с типом IBasketView и реализует корзину. Предоставляет сеттеры для полей items и total и геттер для поля button. Конструктор принимает контейнер с разметкой корзины и экземпляр класса EventEmitter.
- constructor(container: HTMLElement, protected events: EventEmitter)

Поля класса:
- _list: HTMLElement - список товаров
- _total: HTMLElement - итоговая сумма заказа
- _button: HTMLButtonElement - кнопка оформления заказа

#### Класс Success
Класс наследуется от Component с типом ISuccess и реализует окно с сообщением об успешном оформлении заказа.
Устанавливает слушатель на кнопку внутри окна, при нажатии на которую можно продолжить покупки. Предоставляет сеттер для поля total. 
Конструктор принимает контейнер в разметкой окна и функцию-обработчик для кнопки.
- constructor(container: HTMLElement, actions: ISuccessActions)

Поля класса:
- _close: HTMLElement - кнопка закрытия окна заказа
- _total: HTMLElement - итоговая сумма заказа

#### Класс Card
Класс наследуется от Component с типом IProduct и отвечает за отображение карточки, задавая в карточке данные названия, цены товара, которые
присутсвуют во всех представлениях карточек.
В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки.
В классе устанавливаются слушатель на кнопку добавления товара в корзину или на клик по контейнеру, если кнопки в представлении нет.\

Методы:
- сеттеры и геттеры

#### Класс CatalogItem
Отвечает за отображение блока с карточками на главной странице.
- constructor(container: HTMLElement, actions?: ICardActions)

Методы:
- сеттеры и геттеры

#### Класс PreviewItem
Расширяет класс CatalogItem для добавления описания товара в превью.

#### Класс BasketItem
Класс наследуется от Card и отвечает за отображение карточки в корзине. В конструктор передается контейнер с разметкой и функция-обработчик.
- constructor(container: HTMLElement, actions?: ICardActions)

Методы:
- геттер для поля index

#### Класс OrderData
Отвечает за блок сайта с информацией о заказе, содержит поля для хранения данных о заказе.
Устанавливает в конструкторе слушатели на все кнопки, при срабатывании которых генерируются соответствующие события\
Методы:
- сеттеры и геттеры для сохранения и получения данных о заказе

#### Класс Contacts
Класс наследуется от Form с типом IForm Order и содержит поля для хранения контактов клиента.
- constructor(container: HTMLFormElement, events: IEvents).

Методы:
- сеттеры для полей класса

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `items:changed` - изменение данных в каталоге
- `preview:changed` - иизменение выбранной картотчки
- `basket:changed` - изменение данных в корзине
- `orderFormErrors:changed` - изменение ошибок в форме заказа
- `contactsFormErrors:changed` - изменение ошибок в форме контактов

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `basket:open` - открытие модального окна корзины
- `card:select` - карточка для отображения в модальном окне
- `order:open` - открытие модального окна с формой заказа
- `order:submit` - событие, генерируемое при нажатии кнопки "Далее" в форме заказа
- `order:change` - изменение полей в форме заказа
- `contacts:submit` - событие, генерируемое при нажатии кнопки "Оплатить" в форме заказа
- `contacts:change` - изменение полей в форме заказа
- `modal:open` - блокируем прокрутку страницы если открыта модалка
- `modal:close`- разблокируем прокрутку страницы если открыта модалка